(window.webpackJsonp=window.webpackJsonp||[]).push([[97],{240:function(t,e,v){"use strict";v.r(e);var _=v(28),s=Object(_.a)({},(function(){var t=this,e=t.$createElement,v=t._self._c||e;return v("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[v("h2",{attrs:{id:"xss攻击"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#xss攻击"}},[t._v("#")]),t._v(" XSS攻击")]),t._v(" "),v("blockquote",[v("p",[t._v("XSS（Cross-Site Scripting，跨站脚本攻击）是一种代码注入攻击。")])]),t._v(" "),v("p",[v("strong",[t._v("XSS的本质：恶意代码未经过滤，与网站正常代码的代码混在一起；浏览器无法分辨哪些脚本是可信的，导致恶意脚本被执行。由于直接在用户的终端执行，恶意代码能够直接获取用户的信息，利用这些信息冒充用户向网站发起攻击者定义的请求。")])]),t._v(" "),v("h3",{attrs:{id:"反射型（非持久型）xss"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#反射型（非持久型）xss"}},[t._v("#")]),t._v(" 反射型（非持久型）XSS")]),t._v(" "),v("p",[t._v("反射型XSS的攻击步骤：")]),t._v(" "),v("ul",[v("li",[t._v("攻击者构造特殊的 URL，其中包含恶意代码。")]),t._v(" "),v("li",[t._v("用户打开带有恶意代码的 URL 时，网站服务端将恶意代码从URL中取出，拼接在HTML中返回给浏览器。")]),t._v(" "),v("li",[t._v("用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。")]),t._v(" "),v("li",[t._v("恶意代码窃取用户数据并发送到攻击者网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。")])]),t._v(" "),v("p",[v("strong",[t._v("如何防范反射型XSS攻击：")])]),t._v(" "),v("ul",[v("li",[t._v("对字符串进行编码：对url的查询参数进行转义后再输出到页面。")])]),t._v(" "),v("h3",{attrs:{id:"dom型xss"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#dom型xss"}},[t._v("#")]),t._v(" DOM型XSS")]),t._v(" "),v("p",[t._v("DOM型XSS的攻击步骤：")]),t._v(" "),v("ul",[v("li",[t._v("攻击者构造出特殊数据，其中包含恶意代码。")]),t._v(" "),v("li",[t._v("用户浏览器执行了恶意代码。")]),t._v(" "),v("li",[t._v("恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。")])]),t._v(" "),v("p",[v("strong",[t._v("如何防范DOM型XSS攻击：")])]),t._v(" "),v("ul",[v("li",[t._v("对输入内容进行转义（DOM中的内联事件监听器和链接跳转都能把字符串作为代码运行，需要对其内容进行检查）。")]),t._v(" "),v("li",[t._v("对于 url 链接（如图片的src属性），直接使用 "),v("code",[t._v("encodeURIComponent")]),t._v(" 来转义。")]),t._v(" "),v("li",[t._v("非 url，进行编码：")])]),t._v(" "),v("div",{staticClass:"language- line-numbers-mode"},[v("pre",{pre:!0,attrs:{class:"language-text"}},[v("code",[t._v("function encodeHtml(str) {\n    return str.replace(/\"/g, '&quot;')\n            .replace(/'/g, '&apos;')\n            .replace(/</g, '&lt;')\n            .replace(/>/g, '&gt;');\n}\n")])]),t._v(" "),v("div",{staticClass:"line-numbers-wrapper"},[v("span",{staticClass:"line-number"},[t._v("1")]),v("br"),v("span",{staticClass:"line-number"},[t._v("2")]),v("br"),v("span",{staticClass:"line-number"},[t._v("3")]),v("br"),v("span",{staticClass:"line-number"},[t._v("4")]),v("br"),v("span",{staticClass:"line-number"},[t._v("5")]),v("br"),v("span",{staticClass:"line-number"},[t._v("6")]),v("br")])]),v("h3",{attrs:{id:"存储型xss"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#存储型xss"}},[t._v("#")]),t._v(" 存储型XSS")]),t._v(" "),v("p",[t._v("存储型XSS的攻击步骤：")]),t._v(" "),v("ul",[v("li",[t._v("攻击者将恶意代码提交到目标网站的数据库中。")]),t._v(" "),v("li",[t._v("用户打开目标网站时，网站服务端将恶意代码从数据库取出，拼接在HTML中返回给浏览器。")]),t._v(" "),v("li",[t._v("用户浏览器接收到响应后解析执行，混在其中的恶意代码也被执行。")]),t._v(" "),v("li",[t._v("恶意代码窃取用户数据并发送到攻击者的网站，或者冒充用户的行为，调用目标网站接口执行攻击者指定的操作。")])]),t._v(" "),v("p",[v("strong",[t._v("这种攻击常见于带有用户保存数据的网站功能，如：论坛发帖、商品评论、用户私信等。")])]),t._v(" "),v("p",[v("strong",[t._v("如何防范存储型XSS攻击：")])]),t._v(" "),v("ul",[v("li",[t._v("前端数据传递给服务器之前，先转义/过滤（防范不了抓包修改数据的情况）")]),t._v(" "),v("li",[t._v("服务器接收到数据，在存储到数据库之前，进行转义/过滤")]),t._v(" "),v("li",[t._v("前端接收到服务器传递过来的数据，在展示到页面前，先进行转义/过来")])]),t._v(" "),v("h2",{attrs:{id:"防范xss攻击"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#防范xss攻击"}},[t._v("#")]),t._v(" 防范XSS攻击")]),t._v(" "),v("h3",{attrs:{id:"content-security-policy"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#content-security-policy"}},[t._v("#")]),t._v(" Content Security Policy")]),t._v(" "),v("blockquote",[v("p",[t._v("在服务端使用 HTTP的 "),v("code",[t._v("Content-Security-Policy")]),t._v(" 头部来指定策略，或者在前端设置 meta 标签。")])]),t._v(" "),v("p",[t._v("严格的CSP在XSS的防范中可以起到以下的作用：")]),t._v(" "),v("ul",[v("li",[t._v("禁止加载外域代码，防止复杂的攻击逻辑")]),t._v(" "),v("li",[t._v("禁止外域提交，网站被攻击后，用户的数据不会泄露到外域")]),t._v(" "),v("li",[t._v("禁止内联脚本执行")]),t._v(" "),v("li",[t._v("禁止未授权的脚本执行")]),t._v(" "),v("li",[t._v("合理使用上报可以及时发现XSS，利于尽快修复问题")])]),t._v(" "),v("h3",{attrs:{id:"输入内容长度控制"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#输入内容长度控制"}},[t._v("#")]),t._v(" 输入内容长度控制")]),t._v(" "),v("p",[t._v("对于不受信任的输入，都应该限定一个合理的长度。虽然无法完全防止XSS发生，但可以增加XSS攻击的难度。")]),t._v(" "),v("h3",{attrs:{id:"输入内容限制"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#输入内容限制"}},[t._v("#")]),t._v(" 输入内容限制")]),t._v(" "),v("p",[t._v("对于部分输入，可以限定不能包含特殊字符或者仅能输入数字等。")]),t._v(" "),v("h3",{attrs:{id:"其他安全措施"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#其他安全措施"}},[t._v("#")]),t._v(" 其他安全措施")]),t._v(" "),v("ul",[v("li",[t._v("HTTP-only Cookie：禁止 JavaScript 读取某些敏感 Cookie，攻击者完成 XSS 注入后也无法窃取此 Cookie。")]),t._v(" "),v("li",[t._v("验证码：防止脚本冒充用户提交危险操作。")])]),t._v(" "),v("h2",{attrs:{id:"csrf"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#csrf"}},[t._v("#")]),t._v(" CSRF")]),t._v(" "),v("blockquote",[v("p",[t._v("CSRF（Cross-site request forgery）跨站请求伪造：攻击者诱导受害者进入第三方网站，在第三方网站中，\n向被攻击网站发送跨站请求。利用受害者在被攻击网站已经获取的注册凭证，绕过后台的用户验证，达到冒充用户对被攻击的\n网站执行某项操作的目的。")])]),t._v(" "),v("p",[v("strong",[t._v("典型的CSRF攻击流程：")])]),t._v(" "),v("ul",[v("li",[t._v("受害者登录A站点，并保留了登录凭证（Cookie）。")]),t._v(" "),v("li",[t._v("攻击者诱导受害者访问了站点B。")]),t._v(" "),v("li",[t._v("站点B向站点A发送了一个请求，浏览器会默认携带站点A的Cookie信息。")]),t._v(" "),v("li",[t._v("站点A接收到请求后，对请求进行验证，并确认是受害者的凭证，误以为是无辜的受害者发送的请求。")]),t._v(" "),v("li",[t._v("站点A以受害者的名义执行了站点B的请求。")]),t._v(" "),v("li",[t._v("攻击完成，攻击者在受害者不知情的情况下，冒充受害者完成了攻击。")])]),t._v(" "),v("p",[v("img",{attrs:{src:"https://i.loli.net/2020/06/26/jtHcyrUlbZo7GQw.png",alt:""}})]),t._v(" "),v("h3",{attrs:{id:"csrf的特点"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#csrf的特点"}},[t._v("#")]),t._v(" CSRF的特点")]),t._v(" "),v("ul",[v("li",[t._v("攻击通常在第三方网站发起，如图上的站点B，站点A无法防止攻击发生。")]),t._v(" "),v("li",[v("strong",[t._v("攻击利用受害者在被攻击网站的登录凭证，冒充受害者提交操作；并不会去获取cookie信息（cookie）有同源策略。")])]),t._v(" "),v("li",[t._v("跨站请求可以用各种方式：图片URL、超链接、CORS、Form提交等等（来源不明的链接不点击）。")])]),t._v(" "),v("h3",{attrs:{id:"csrf攻击防御"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#csrf攻击防御"}},[t._v("#")]),t._v(" CSRF攻击防御")]),t._v(" "),v("h4",{attrs:{id:"添加验证码（体验不好）"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#添加验证码（体验不好）"}},[t._v("#")]),t._v(" 添加验证码（体验不好）")]),t._v(" "),v("p",[t._v("验证码能够防御CSRF攻击，但是不可能每一次交互都需要验证码，否则用户的体验会非常差，但是我们可以在\n转账，交易等操作时，增加验证码，确保我们的账户安全。")]),t._v(" "),v("h4",{attrs:{id:"判断请求的来源：检测referer（并不安全，referer可以被更改）"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#判断请求的来源：检测referer（并不安全，referer可以被更改）"}},[t._v("#")]),t._v(" 判断请求的来源：检测Referer（并不安全，Referer可以被更改）")]),t._v(" "),v("p",[v("code",[t._v("Referer")]),t._v(" 可以作为一种辅助手段，来判断请求的来源是否是安全的，但是鉴于"),v("code",[t._v("Referer")]),t._v("本身是可以被修改的，\n因此不能仅依赖于"),v("code",[t._v("Referer")]),t._v("。")]),t._v(" "),v("h4",{attrs:{id:"使用token（主流）"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#使用token（主流）"}},[t._v("#")]),t._v(" 使用Token（主流）")]),t._v(" "),v("p",[v("strong",[t._v("CSRF攻击之所以能成功，是因为服务器误把攻击者发送的请求当成了用户自己的请求。那么可以要求所有的用户请求都携带\n一个CSRF攻击者无法获取到的Token。服务器通过校验请求是否携带正确的Token，来把正常的请求和攻击的请求区分开。\n跟验证码类似，只是用户无感知。")])]),t._v(" "),v("ul",[v("li",[t._v("服务端给用户生成一个token，加密后传递给用户")]),t._v(" "),v("li",[t._v("用户在提交请求时，需要携带上这个token")]),t._v(" "),v("li",[t._v("服务端验证token是否正确")])]),t._v(" "),v("h4",{attrs:{id:"samesite-cookie属性"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#samesite-cookie属性"}},[t._v("#")]),t._v(" Samesite Cookie属性")]),t._v(" "),v("p",[v("strong",[v("code",[t._v("Samesite=Strict")]),t._v(" 被称为严格模式，表明这个 Cookie 在任何情况都不可能作为第三方的 Cookie，\n有能力阻止所有CSRF攻击。此时，在B站点下发起对A站点的任何请求，A站点的 Cookie 都不会包含在cookie请求头中。")])]),t._v(" "),v("p",[v("code",[t._v("Samesite=Lax")]),t._v(" 被称为宽松模式，与 Strict 相比放宽了限制，允许发送安全 HTTP 方法带上 Cookie，如 "),v("code",[t._v("Get")]),t._v("、"),v("code",[t._v("OPTIONS")]),t._v("、"),v("code",[t._v("HEAD")]),t._v("请求。\n但是不允许不安全HTTP的方法，如："),v("code",[t._v("POST")]),t._v("、"),v("code",[t._v("PUT")]),t._v("、"),v("code",[t._v("DELETE")]),t._v("请求时，不能作为第三方链接的 Cookie。")]),t._v(" "),v("h2",{attrs:{id:"点击劫持"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#点击劫持"}},[t._v("#")]),t._v(" 点击劫持")]),t._v(" "),v("h2",{attrs:{id:"参考文章"}},[v("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[t._v("#")]),t._v(" 参考文章")]),t._v(" "),v("ul",[v("li",[v("a",{attrs:{href:"https://juejin.im/post/5cd6ad7a51882568d3670a8e",target:"_blank",rel:"noopener noreferrer"}},[t._v("寒冬求职之你必须要懂的Web安全"),v("OutboundLink")],1)]),t._v(" "),v("li",[v("a",{attrs:{href:""}})])])])}),[],!1,null,null,null);e.default=s.exports}}]);