(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{293:function(t,e,r){"use strict";r.r(e);var s=r(28),a=Object(s.a)({},(function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("p",[r("strong",[t._v("当数据发生变化时，将通知需要更新的 watcher 收集到一个队列中，并且加入队列的过程中将会对 watcher 进行去重操作，然后在 nextTick 函数里会遍历执行 watcher 的更新，nextTick 相当于创建了一个异步任务（可能是异步微任务也可能是异步宏任务），然后在下一个\nevent loop 执行这些异步任务。将同步代码里的所有数据更改需要通知更新的操作都收集起来，放到一个异步任务中统一处理，避免了频繁的更新视图这样耗费性能的操作。")])]),t._v(" "),r("h2",{attrs:{id:"数据变更时机：下一个的事件循环-tick"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#数据变更时机：下一个的事件循环-tick"}},[t._v("#")]),t._v(" 数据变更时机：下一个的事件循环 tick")]),t._v(" "),r("p",[r("strong",[t._v("每次事件循环之后都会触发UI渲染，一次事件循环指的是一个宏任务（task）和一个微任务（microtask）队列执行完成。")])]),t._v(" "),r("p",[r("img",{attrs:{src:"https://i.loli.net/2020/07/14/QrmzDubASiB85YZ.png",alt:""}})]),t._v(" "),r("p",[r("strong",[t._v("UI渲染在微任务队列执行完之后，要赶在UI渲染之前做完数据变更，就需要生成一个task或者microtask来做这件事。")]),t._v(" 优先使用microtask，"),r("strong",[t._v("因为不管在宏任务还是微任务里修改state，接下来执行的都是微任务（如果还有待执行的微任务的话），新生成的microtask会push到当前这一次事件循环的microtask队列末尾，它会在这一次事件循环结束前执行到，如果是task则会push到task队列末尾，可能需要等待多次事件循环后才执行（取决于task队列的长度），等待时间较长。")])]),t._v(" "),r("p",[t._v("异步不是目的，只是手段，想要数据变更尽快执行就用微任务。"),r("code",[t._v("Vue.nextTick(callback)")]),t._v(" 就遵循这个原则，优先使用会生成 microtask 的 "),r("code",[t._v("Promise.then")]),t._v(" 和 "),r("code",[t._v("MutationObserver")]),t._v("；若浏览器不支持则用 "),r("code",[t._v("setTimeout")]),t._v(" 或者 "),r("code",[t._v("setImmediate")]),t._v(" 代替。")]),t._v(" "),r("p",[r("strong",[t._v("总结：浏览器支持 "),r("code",[t._v("Promise.then")]),t._v(" 或 "),r("code",[t._v("MutationObserver")]),t._v(' 的情况下，"下一个的事件循环tick" 指的是本次事件循环最后一个 microtask；否则指的是task队列中的最后一个task。')])]),t._v(" "),r("h2",{attrs:{id:"参考文章"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#参考文章"}},[t._v("#")]),t._v(" 参考文章")]),t._v(" "),r("ul",[r("li",[r("a",{attrs:{href:"https://github.com/Advanced-Frontend/Daily-Interview-Question/issues/281",target:"_blank",rel:"noopener noreferrer"}},[t._v("谈一谈 nextTick 的原理"),r("OutboundLink")],1)]),t._v(" "),r("li",[r("a",{attrs:{href:"https://mp.weixin.qq.com/s/HzttRWoAWeaA4wfwnvPR4w",target:"_blank",rel:"noopener noreferrer"}},[t._v("Vue你必须知道的异步更新机制和nextTick原理"),r("OutboundLink")],1)])])])}),[],!1,null,null,null);e.default=a.exports}}]);